<template>
  <div class="ptz-cmd-block">
    <div class="control">
      <svg
        v-for="n in 8"
        @click="ptzCmdDirection(n)"
        :class="'arrow' + n"
        viewBox="0 0 1024 1024"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        width="64"
        height="64">
        <path
          d="M682.666667 955.733333H341.333333a17.066667 17.066667 0 0 1-17.066666-17.066666V529.066667H85.333333a17.066667 17.066667 0 0 1-12.066133-29.1328l426.666667-426.666667a17.0496 17.0496 0 0 1 24.132266 0l426.666667 426.666667A17.066667 17.066667 0 0 1 938.666667 529.066667H699.733333v409.6a17.066667 17.066667 0 0 1-17.066666 17.066666z m-324.266667-34.133333h307.2V512a17.066667 17.066667 0 0 1 17.066667-17.066667h214.801066L512 109.4656 126.532267 494.933333H341.333333a17.066667 17.066667 0 0 1 17.066667 17.066667v409.6z"
          p-id="6849" />
      </svg>
    </div>
    <div class="control control2">
      <el-tooltip effect="light" content="镜头放大" placement="top" :open-delay="200">
        <svg
          @click="ptzCmd(ptzType.zoomFar)"
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg">
          <path
            d="M994.990643 859.352971L713.884166 578.246494A381.208198 381.208198 0 0 0 767.307984 383.653992C767.307984 171.765089 595.542895 0 383.653992 0S0 171.765089 0 383.653992s171.765089 383.653992 383.653992 383.653992c71.119859 0 137.507985-19.694238 194.592502-53.423818l281.106477 281.090491a95.913498 95.913498 0 1 0 135.637672-135.621686zM383.653992 671.394486c-158.912681 0-287.740494-128.827813-287.740494-287.740494S224.741311 95.913498 383.653992 95.913498s287.740494 128.827813 287.740494 287.740494-128.827813 287.740494-287.740494 287.740494z m159.85583-335.697243h-111.899081v-111.899081a47.956749 47.956749 0 1 0-95.913498 0v111.899081h-111.899081a47.956749 47.956749 0 1 0 0 95.913498h111.899081v111.899081a47.956749 47.956749 0 1 0 95.913498 0v-111.899081h111.899081a47.956749 47.956749 0 1 0 0-95.913498z" />
        </svg>
      </el-tooltip>
      <el-tooltip effect="light" content="镜头缩小" placement="top" :open-delay="200">
        <svg
          @click="ptzCmd(ptzType.zoomNear)"
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg">
          <path
            d="M994.990643 859.352971L713.884166 578.246494A381.208198 381.208198 0 0 0 767.307984 383.653992C767.307984 171.765089 595.542895 0 383.653992 0S0 171.765089 0 383.653992s171.765089 383.653992 383.653992 383.653992c71.119859 0 137.507985-19.694238 194.592502-53.423818l281.106477 281.090491a95.913498 95.913498 0 1 0 135.637672-135.621686zM383.653992 671.394486c-158.912681 0-287.740494-128.827813-287.740494-287.740494S224.741311 95.913498 383.653992 95.913498s287.740494 128.827813 287.740494 287.740494-128.827813 287.740494-287.740494 287.740494z m159.85583-335.697243H223.798162a47.956749 47.956749 0 1 0 0 95.913498h319.71166a47.956749 47.956749 0 1 0 0-95.913498z" />
        </svg>
      </el-tooltip>
    </div>
    <div class="control control3">
      <el-tooltip effect="light" content="光圈缩小" placement="top" :open-delay="200">
        <svg
          @click="ptzCmd(ptzType.apertureFar)"
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg">
          <path
            d="M956.39 400.827C922.164 266.675 828.186 155.703 701.502 99.874l94.522 443.782L956.39 400.827zM206.208 189.167C106.183 286.191 56.845 424.181 72.696 562.659l351.347-309.096-217.835-64.396zM643.118 78.847a446.363 446.363 0 0 0-138.947-16.775 448.047 448.047 0 0 0-250.583 86.934l437.868 146.949-48.338-217.108zM83.786 623.979c34.443 133.772 128.248 244.407 254.583 300.291l-95.915-426.55L83.786 623.979zM969.893 496.089a372.746 372.746 0 0 0-2.37-34.138l-329.972 303.78 196.157 69.256c91.522-88.456 141.056-211.704 136.185-338.898zM396.862 945.166a447.857 447.857 0 0 0 139.077 16.766 447.784 447.784 0 0 0 250.322-86.718L349.286 733.05l47.576 212.116z" />
          <path
            fill="#333333"
            d="M397.253 471.171h245.668c22.593 0 40.923 18.32 40.923 40.913 0 22.592-18.33 40.922-40.923 40.922H397.253c-22.592 0-40.922-18.33-40.922-40.922 0-22.593 18.33-40.913 40.922-40.913z" />
          <path
            fill="#333333"
            d="M479.17 634.879V389.21c0-22.593 18.32-40.923 40.913-40.923s40.923 18.33 40.923 40.923v245.668c0 22.592-18.33 40.922-40.923 40.922s-40.913-18.329-40.913-40.921z" />
        </svg>
      </el-tooltip>
      <el-tooltip effect="light" content="光圈放大" placement="top" :open-delay="200">
        <svg
          @click="ptzCmd(ptzType.apertureNear)"
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg">
          <path
            d="M956.39 400.827C922.164 266.675 828.186 155.703 701.502 99.874l94.522 443.782L956.39 400.827z m-750.182-211.66C106.183 286.191 56.845 424.181 72.696 562.659l351.347-309.096-217.835-64.396z m436.91-110.32a446.363 446.363 0 0 0-138.947-16.775 448.047 448.047 0 0 0-250.583 86.934l437.868 146.949-48.338-217.108zM83.786 623.979c34.443 133.772 128.248 244.407 254.583 300.291l-95.915-426.55L83.786 623.979z m886.107-127.89a372.746 372.746 0 0 0-2.37-34.138l-329.972 303.78 196.157 69.256c91.522-88.456 141.056-211.704 136.185-338.898zM396.862 945.166a447.857 447.857 0 0 0 139.077 16.766 447.784 447.784 0 0 0 250.322-86.718L349.286 733.05l47.576 212.116z m0.391-474.039h245.668c22.593 0 40.923 18.32 40.923 40.912 0 22.593-18.33 40.923-40.923 40.923H397.253c-22.592 0-40.922-18.33-40.922-40.923 0-22.592 18.33-40.912 40.922-40.912z" />
        </svg>
      </el-tooltip>
    </div>
    <div class="control control4">
      <el-tooltip effect="light" content="光圈缩小" placement="top" :open-delay="200">
        <svg
          @click="ptzCmd(ptzType.focusFar)"
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg">
          <path
            d="M849.07153297 646.81872559c9.30432153 0 17.26391602 3.30249 23.82934617 9.88769507 6.60992408 6.59509253 9.88769508 14.52502465 9.88769508 23.79473901v101.14617896c0 27.90801978-9.87780761 51.70275879-29.61364722 71.47814965-19.75067115 19.77539086-43.56518578 29.66308594-71.48803711 29.66308594h-101.1165166c-9.32409644 0-17.25402856-3.29754663-23.83428954-9.9865725-6.59509253-6.49127173-9.90252662-14.52502465-9.90252662-23.7947383 0-9.26971435 3.30743408-17.20458984 9.90252662-23.79473901 6.58026099-6.59014916 14.51019311-9.88769508 23.83428954-9.88769507h101.1165166c9.29937744 0 17.26391602-3.29754663 23.82440137-9.88769579 6.61486816-6.59014916 9.88769508-14.52008057 9.88769579-23.89361573v-101.04235815c0-9.36859107 3.28765845-17.30346656 9.89758254-23.78979493 6.57531762-6.69396997 14.52502465-9.99151587 23.83923363-9.99151587l-0.06427025 0.09887671zM242.38726782 141.3103025h101.10168506c9.30432153 0 17.2688601 3.29754663 23.819458 9.88769578 6.62475562 6.59509253 9.89758325 14.52502465 9.89758254 23.7947383 0 9.37353516-3.27282691 17.30346656-9.89758254 23.79473901-6.5505979 6.69396997-14.51513648 9.9865725-23.81451463 9.9865725h-101.10168433c-9.31915307 0-17.2688601 3.19372583-23.82934547 9.88769508-6.62475562 6.49127173-9.91241479 14.52502465-9.91241479 23.794739v101.04235816c0 9.36859107-3.28271508 17.30346656-9.89758324 23.89361573-6.57531762 6.59014916-14.51513648 9.88769508-23.81451392 9.88769507-9.31420898 0-17.25402856-3.29754663-23.82934547-9.88769507C144.49908423 360.80230689 141.21142578 352.86743141 141.21142578 343.49884033V242.45648217c0-27.91296386 9.86792016-51.70275879 29.62353539-71.47814965 19.75067115-19.77539086 43.57507324-29.66308594 71.48803711-29.66308594h0.06426954zM174.9877932 646.81872559c9.30432153 0 17.24414039 3.30249 23.81451393 9.88769507 6.62475562 6.59509253 9.90252662 14.52502465 9.90252662 23.79473901v101.14617896c0 9.26971435 3.27282691 17.19964576 9.89758324 23.78979492 6.57531762 6.59014916 14.51513648 9.88769508 23.81451393 9.88769579h101.12640404c9.29937744 0 17.25402856 3.29754663 23.82934547 9.88769507 6.60992408 6.59014916 9.88769508 14.52502465 9.88769579 23.89361572 0 9.26971435-3.27777099 17.20458984-9.88769579 23.79473901-6.57531762 6.59014916-14.52996803 9.88769508-23.82934547 9.88769508H242.41693092c-27.91296386 0-51.71264625-9.88769508-71.47814895-29.66308594-19.75561523-19.67651344-29.62353539-43.57012915-29.62353539-71.47814965v-101.04235816c0-9.26971435 3.27282691-17.30346656 9.88769507-23.89361573 6.58026099-6.59509253 14.52502465-9.88769508 23.81451464-9.88769507h-0.02966309zM680.57037329 141.3103025h101.1165166c27.92285133 0 51.73736596 9.88769508 71.48803711 29.56420922 19.73583961 19.77539086 29.61364722 43.57012915 29.61364722 71.47814965v101.14617896c0 9.26971435-3.27777099 17.30346656-9.88769508 23.78979493-6.56542945 6.69396997-14.52502465 9.88769508-23.82934617 9.88769506-9.29937744 0-17.26391602-3.19372583-23.82440139-9.88769506-6.61486816-6.48632836-9.88769508-14.52008057-9.88769579-23.78979493V242.35266137c0-9.26971435-3.28765845-17.19964576-9.90252661-23.78979492-6.57037354-6.59509253-14.52008057-9.88769508-23.83428955-9.88769579h-101.10168433c-9.31420898 0-17.2688601-3.29754663-23.82934618-9.88769507-6.60992408-6.59509253-9.89758325-14.52502465-9.89758254-23.79473902 0-9.37353516 3.28765845-17.30346656 9.89758254-23.89361571 6.56048608-6.59014916 14.51513648-9.88769508 23.82934618-9.88769508l0.04943799 0.09887672z" />
        </svg>
      </el-tooltip>
      <el-tooltip effect="light" content="光圈缩小" placement="top" :open-delay="200">
        <svg
          @click="ptzCmd(ptzType.focusNear)"
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg">
          <path
            d="M512 170.666667A341.333333 341.333333 0 1 1 170.666667 512 341.333333 341.333333 0 0 1 512 170.666667m0-42.666667a384 384 0 1 0 384 384A384 384 0 0 0 512 128z" />
          <path
            fill="#333333"
            d="M298.666667 533.333333H170.666667a21.333333 21.333333 0 0 1 0-42.666666h128a21.333333 21.333333 0 0 1 0 42.666666zM853.333333 533.333333h-128a21.333333 21.333333 0 0 1 0-42.666666h128a21.333333 21.333333 0 0 1 0 42.666666zM512 320a21.333333 21.333333 0 0 1-21.333333-21.333333V170.666667a21.333333 21.333333 0 0 1 42.666666 0v128a21.333333 21.333333 0 0 1-21.333333 21.333333zM512 874.666667a21.333333 21.333333 0 0 1-21.333333-21.333334v-128a21.333333 21.333333 0 0 1 42.666666 0v128a21.333333 21.333333 0 0 1-21.333333 21.333334z" />
        </svg>
      </el-tooltip>
    </div>
    <div class="control-speed">
      速度(1-10)：
      <el-input-number size="small" v-model="ptzSpeed" :min="1" :max="10" label="速度" />
    </div>
  </div>
</template>

<script lang="ts" setup>
  import { PTZ_TYPE, getPTZCmd } from '@/utils/v4/ptz-cmd'
  import { ptzCmdGb28181 } from '@/api/instance/index'
  import { ref } from 'vue'

  const PTZ_DIRECTION_ARRAY = [
    PTZ_TYPE.up,
    PTZ_TYPE.right,
    PTZ_TYPE.down,
    PTZ_TYPE.left,
    PTZ_TYPE.leftUp,
    PTZ_TYPE.rightUp,
    PTZ_TYPE.leftDown,
    PTZ_TYPE.rightDown
  ]

  const props = defineProps({
    tempItem: {
      type: Object
    }
  })
  const ptzType = ref(PTZ_TYPE)
  const arrowTips = ref(['上', '右', '下', '左', '左上', '右上', '左下', '右下'])
  const ptzSpeed = ref(50)
  const ptzPositionIndex = ref(1)
  const ptzCmd = (type, isCycling) => {
    const { tempItem } = props
    const options = {
      type: type,
      speed: ptzSpeed.value,
      index: ptzPositionIndex.value,
      cycle: isCycling
    }
    const ptzCmd = getPTZCmd(options)
    const ptzCmdStop = getPTZCmd({ type: PTZ_TYPE.stop })
    ptzCmdGb28181({
      id: tempItem.id,
      channel: tempItem.channel,
      ptzcmd: ptzCmd
    }).then(() => {
      ptzCmdGb28181({
        id: tempItem.id,
        channel: tempItem.channel,
        ptzcmd: ptzCmdStop
      })
    })
  }
  const ptzCmdDirection = (direction) => {
    const type = PTZ_DIRECTION_ARRAY[direction - 1]
    ptzCmd(type)
  }
  const startPtzCmdCycle = () => {
    ptzCmd(PTZ_TYPE.right, true)
  }
  const stopPtzCmdCycle = () => {
    ptzCmd(PTZ_TYPE.stop)
  }
</script>

<style lang="less" scoped>
  .ptz-cmd-block {
    width: 100%;
    height: 100%;
    position: relative;

    .arrow1 {
      grid-column: 2;
      grid-row: 1;
    }

    .arrow2 {
      transform: rotate(90deg);
      grid-column: 3;
      grid-row: 2;
    }

    .arrow3 {
      transform: rotate(180deg);
      grid-column: 2;
      grid-row: 3;
    }

    .arrow4 {
      transform: rotate(270deg);
      grid-column: 1;
      grid-row: 2;
    }

    .arrow5 {
      transform: rotate(-45deg);
      grid-column: 1;
      grid-row: 1;
    }

    .arrow6 {
      transform: rotate(45deg);
      grid-column: 3;
      grid-row: 1;
    }

    .arrow7 {
      transform: rotate(-135deg);
      grid-column: 1;
      grid-row: 3;
    }

    .arrow8 {
      transform: rotate(135deg);
      grid-column: 3;
      grid-row: 3;
    }

    .arrow9 {
      grid-column: 2;
      grid-row: 2;
    }

    .container {
      position: relative;
      height: 350px;
    }

    .control {
      position: absolute;
      top: 40px;
      left: 15px;
      display: grid;
      grid-template-columns: repeat(3, 33.33%);
      grid-template-rows: repeat(3, 33.33%);
      width: 192px;
      height: 192px;
    }

    .control2 {
      top: 230px;
    }

    .control3 {
      top: 280px;
    }

    .control4 {
      top: 330px;
    }

    .control5 {
      top: 380px;
    }

    .control > * {
      cursor: pointer;
      fill: gray;
      width: 50px;
      height: 50px;
    }

    .control5 > * {
      margin-right: 10px;
    }

    .control2 > *,
    .control3 > *,
    .control4 > * {
      width: 40px;
      height: 40px;
    }

    .control > *:hover,
    .cycling {
      fill: #409eff;
    }

    .control-speed {
      position: absolute;
      top: 5px;
    }
  }
</style>
