var P=1e3,w=function(){function f(){this.dataPoints_=[],this.color_="red",this.isVisible_=!0,this.cacheStartTime_=null,this.cacheStepSize_=0,this.cacheValues_=[]}f.prototype={toJSON:function(){if(this.dataPoints_.length<1)return{};for(var a=[],_=0;_<this.dataPoints_.length;++_)a.push(this.dataPoints_[_].value);return{startTime:this.dataPoints_[0].time,endTime:this.dataPoints_[this.dataPoints_.length-1].time,values:JSON.stringify(a)}},addPoint:function(a,_){var g=new Date(a);this.dataPoints_.push(new S(g,_)),this.dataPoints_.length>P&&this.dataPoints_.shift()},setPoints:function(a){const _=Math.max(0,a.length-P);this.dataPoints_=a.slice(_)},isVisible:function(){return this.isVisible_},show:function(a){this.isVisible_=a},getColor:function(){return this.color_},setColor:function(a){this.color_=a},getCount:function(){return this.dataPoints_.length},getValues:function(a,_,g){return this.cacheStartTime_==a&&this.cacheStepSize_==_&&this.cacheValues_.length==g?this.cacheValues_:(this.cacheValues_=this.getValuesInternal_(a,_,g),this.cacheStartTime_=a,this.cacheStepSize_=_,this.cacheValues_)},getValuesInternal_:function(a,_,g){for(var T=[],u=0,m=0,p=a,d=0;d<g;++d){for(;u<this.dataPoints_.length&&this.dataPoints_[u].time<p;)m=this.dataPoints_[u].value,++u;T[d]=m,p+=_}return T}};function S(a,_){this.time=a,this.value=_}return f}(),R=w,L=function(){var f=10,S=6,a=4,_=3,g=10,T="#CCC",u="#000",m="#FFF",p=2;function d(i,t){this.scrollbar_={position_:0,range_:0},this.devicePixelRatio=t||1,this.canvas_=i,i.width=parseInt(i.width,10)*this.devicePixelRatio,i.height=parseInt(i.height,10)*this.devicePixelRatio,this.gridColor=T,this.textColor=u,this.backgroundColor=m,this.timeLocales=[],this.timeOptions={},this.startTime_=0,this.endTime_=1,this.graph_=null,this.scale_=1e3/this.devicePixelRatio,this.updateScrollbarRange_(!0)}d.prototype={setScale:function(i){this.scale_=i},getLength_:function(){var i=this.endTime_-this.startTime_;return Math.floor(i/this.scale_)},graphScrolledToRightEdge_:function(){return this.scrollbar_.position_==this.scrollbar_.range_},updateScrollbarRange_:function(i){var t=this.getLength_()-this.canvas_.width;t<0&&(t=0),this.scrollbar_.position_>t&&(i=!0),this.scrollbar_.range_=t,i&&(this.scrollbar_.position_=t,this.repaint())},setDateRange:function(i,t){this.startTime_=i.getTime(),this.endTime_=t.getTime(),this.endTime_<=this.startTime_&&(this.startTime_=this.endTime_-1),this.updateScrollbarRange_(!0)},updateEndDate:function(i){this.endTime_=i||new Date().getTime(),this.updateScrollbarRange_(this.graphScrolledToRightEdge_())},getStartDate:function(){return new Date(this.startTime_)},setDataSeries:function(i){this.graph_=new b(this.devicePixelRatio);for(var t=0;t<i.length;++t)this.graph_.addDataSeries(i[t]);this.repaint()},addDataSeries:function(i){this.graph_||(this.graph_=new b(this.devicePixelRatio)),this.graph_.addDataSeries(i),this.repaint()},repaint:function(){if(this.canvas_.offsetParent!==null){this.repaintTimerRunning_=!1;var i=this.canvas_.width,t=this.canvas_.height,e=this.canvas_.getContext("2d");if(e.fillStyle=this.backgroundColor,e.fillRect(0,0,i,t),!(f*4>t||i<50)){e.save();var h=this.scrollbar_.position_;this.scrollbar_.range_==0&&(h=this.getLength_()-i);var s=this.startTime_+h*this.scale_,r=t;t-=Math.ceil(f*this.devicePixelRatio)+a,this.drawTimeLabels(e,i,t,r,s),e.strokeStyle=this.gridColor,e.lineWidth=this.devicePixelRatio,e.strokeRect(1,1,i-1,t-1),this.graph_&&(this.graph_.layout(i,t,f,s,this.scale_),this.graph_.drawTicks(e),this.graph_.drawLines(e),this.graph_.drawLabels(e)),e.restore()}}},drawTimeLabels:function(i,t,e,h,s){var r=6e4,n=Math.ceil(s/r)*r;for(i.textBaseline="bottom",i.textAlign="center",i.fillStyle=this.textColor,i.strokeStyle=this.gridColor,i.lineWidth=this.devicePixelRatio,i.font=i.font.replace(/\d+px/,`${f*this.devicePixelRatio}px`);;){var l=Math.round((n-s)/this.scale_);if(l>=t)break;var c=new Date(n).toLocaleTimeString(this.timeLocales,this.timeOptions);i.fillText(c,l,h),i.beginPath(),i.lineTo(l,1),i.lineTo(l,e),i.stroke(),n+=r}},getDataSeriesCount:function(){return this.graph_?this.graph_.dataSeries_.length:0},hasDataSeries:function(i){return this.graph_?this.graph_.hasDataSeries(i):!1}};var b=function(){function i(t){this.devicePixelRatio=t||1,this.dataSeries_=[],this.width_=0,this.height_=0,this.fontHeight_=0,this.startTime_=0,this.scale_=0,this.min_=0,this.max_=0,this.labels_=[]}return i.prototype={addDataSeries:function(t){this.dataSeries_.push(t)},hasDataSeries:function(t){for(var e=0;e<this.dataSeries_.length;++e)if(this.dataSeries_[e]==t)return!0;return!1},getValues:function(t){return t.isVisible()?t.getValues(this.startTime_,this.scale_,this.width_):null},layout:function(t,e,h,s,r){this.width_=t,this.height_=e,this.fontHeight_=h,this.startTime_=s,this.scale_=r;for(var n=0,l=0,c=0;c<this.dataSeries_.length;++c){var o=this.getValues(this.dataSeries_[c]);if(o)for(var v=0;v<o.length;++v)o[v]>n?n=o[v]:o[v]<l&&(l=o[v])}this.layoutLabels_(l,n)},layoutLabels_:function(t,e){if(e-t<1024){this.layoutLabelsBasic_(t,e,p);return}var h=["","k","M","G","T","P"],s=1;for(t/=1024,e/=1024;h[s+1]&&e-t>=1024;)t/=1024,e/=1024,++s;this.layoutLabelsBasic_(t,e,p);for(var r=0;r<this.labels_.length;++r)this.labels_[r]+=" "+h[s];this.min_*=Math.pow(1024,s),this.max_*=Math.pow(1024,s)},layoutLabelsBasic_:function(t,e,h){this.labels_=[];var s=e-t;if(s==0){this.min_=this.max_=e;return}var r=2*this.fontHeight_+a,n=1+this.height_/r;n<2?n=2:n>S&&(n=S);for(var l=Math.pow(10,-h),c=h;!(Math.ceil(s/l)+1<=n);){if(Math.ceil(s/(l*2))+1<=n){l*=2;break}if(Math.ceil(s/(l*5))+1<=n){l*=5;break}l*=10,c>0&&--c}this.max_=Math.ceil(e/l)*l,this.min_=Math.floor(t/l)*l;for(var o=this.max_;o>=this.min_;o-=l)this.labels_.push(o.toFixed(c))},drawTicks:function(t){var e,h;e=this.width_-1,h=this.width_-1-g,t.fillStyle=this.gridColor,t.lineWidth=this.devicePixelRatio,t.beginPath();for(var s=1;s<this.labels_.length-1;++s){var r=Math.round(this.height_*s/(this.labels_.length-1));t.moveTo(e,r),t.lineTo(h,r)}t.stroke()},drawLines:function(t){var e=0,h=this.height_-1;this.max_&&(e=h/(this.max_-this.min_));for(var s=this.dataSeries_.length-1;s>=0;--s){var r=this.getValues(this.dataSeries_[s]);if(r){t.strokeStyle=this.dataSeries_[s].getColor(),t.lineWidth=this.devicePixelRatio,t.beginPath();for(var n=0;n<r.length;++n)t.lineTo(n,h-Math.round((r[n]-this.min_)*e));t.stroke()}}},drawLabels:function(t){if(this.labels_.length!=0){var e=this.width_-_;t.fillStyle=this.textColor,t.textAlign="right",t.textBaseline="top",t.fillText(this.labels_[0],e,0),t.textBaseline="bottom";for(var h=(this.height_-1)/(this.labels_.length-1),s=1;s<this.labels_.length;++s)t.fillText(this.labels_[s],e,h*s)}}},i}();return d}(),C=L;const D=R,M=C;var A={TimelineDataSeries:D,TimelineGraphView:M};export{A as s};
