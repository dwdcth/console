import{_ as S}from"./index-5b101bf5.js";import{B as m}from"./TableAction-1422fddb.js";import{n as E,o as T,q as P,r as R}from"./index-5c5eb8e0.js";import{h as I}from"./vendor-1e70d1e5.js";import"./useDesignSetting-2272415f.js";import"./index-6f9c12d4.js";const U=Vue.createTextVNode("开始录制"),z=Vue.createTextVNode("开始录制"),$=Vue.createTextVNode(" 如何配置请查看官网文档: "),A=Vue.createElementVNode("a",{href:"https://m7s.live/guide/plugins/record.html#api",target:"_blank",style:{color:"#18a058"}},"https://m7s.live/guide/plugins/record.html#api",-1),L=Vue.createTextVNode("取消"),M=Vue.createTextVNode("确认"),Q=Vue.defineComponent({__name:"index",setup(q){const V=Vue.ref(null),a=naive.useMessage(),n=Vue.ref(!1),{params:l}=I(),o=Vue.reactive({recordStreamPath:"",fileName:"",fragment:"",recordType:"flv"}),p={recordStreamPath:{required:!0,trigger:["blur","input"],message:"输入需要录制的StreamPath"}};function f(t){return t>1024*1024?(t/1024/1024).toFixed(2)+" MB":t>1024?(t/1024).toFixed(2)+" KB":t.toString()+" B"}const _=[{title:"ID",key:"ID"},{title:"Type",key:"Type",width:150},{title:"开始时间",render:t=>Vue.h(naive.NTime,{type:"relative",time:new Date(t.StartTime)}),width:150}],C={title:"操作",key:"action",width:100,render:t=>Vue.h(naive.NButton,{type:"error",size:"small",onClick:()=>{T(l.id,t.ID).then(e=>{e=="ok"?a.success("停止录制成功"):a.error("停止录制失败")}).catch(e=>{a.error(e)})}},["停止"])},h=[{title:"文件",key:"Path"},{title:"大小",render:t=>Vue.h("text",f(t.Size)),width:100},{title:"时长",key:"Duration",width:100}],F=[],i=Vue.ref([]),s=Vue.ref([]);E(l.id).then(t=>{i.value=t||[],i.value=i.value.sort((e,r)=>e.Path.localeCompare(r.Path))});function v(){P(l.id).then(t=>{s.value=t||[],s.value=s.value.sort((e,r)=>e.ID.localeCompare(r.ID))})}function N(){V.value.validate(t=>{if(!t){if(o.fileName!==""&&!/^[a-z0-9_]*$/g.test(o.fileName)){a.error("文件名只允许数字、字母和下划线组合");return}R(l.id,o.recordStreamPath,o.recordType,o.fileName="",o.fragment="0").then(e=>{e?a.success("开始录制成功"):a.error("开始录制失败")}).catch(()=>{n.value=!1})}})}return(t,e)=>{const r=Vue.resolveComponent("n-tab-pane"),w=Vue.resolveComponent("n-tabs"),B=Vue.resolveComponent("n-layout-content"),x=Vue.resolveComponent("n-radio-button"),g=Vue.resolveComponent("n-radio-group"),d=Vue.resolveComponent("n-form-item"),c=Vue.resolveComponent("n-input"),y=Vue.resolveComponent("n-form"),k=Vue.resolveComponent("n-space"),b=Vue.resolveComponent("n-modal"),D=Vue.resolveComponent("n-layout");return Vue.openBlock(),Vue.createBlock(D,null,{default:Vue.withCtx(()=>[Vue.createVNode(B,{"content-style":"padding: 24px;"},{default:Vue.withCtx(()=>[Vue.createVNode(w,{type:"line",animated:""},{default:Vue.withCtx(()=>[Vue.createVNode(r,{name:"filelist",tab:"录像文件列表"},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(m),{title:"录像文件列表",class:"table","row-class-name":"row",columns:h,dataSource:i.value,pagination:{simple:!0},actionColumn:F,"row-key":u=>u.Name,"scroll-x":1090},{toolbar:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(naive.NButton),{onClick:e[0]||(e[0]=u=>n.value=!0)},{default:Vue.withCtx(()=>[U]),_:1})]),_:1},8,["dataSource","row-key"])]),_:1}),Vue.createVNode(r,{name:"recording",tab:"正在录制列表"},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(m),{title:"正在录制的流列表",class:"table","row-class-name":"row",columns:_,dataSource:s.value,pagination:{simple:!0},actionColumn:C,"row-key":u=>u.ID,"scroll-x":1090},{toolbar:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(S),{onTick:v,style:{padding:"0 20px 0 0"}}),Vue.createVNode(Vue.unref(naive.NButton),{onClick:e[1]||(e[1]=u=>n.value=!0)},{default:Vue.withCtx(()=>[z]),_:1})]),_:1},8,["dataSource","row-key"])]),_:1})]),_:1})]),_:1}),Vue.createVNode(b,{show:n.value,"onUpdate:show":e[7]||(e[7]=u=>n.value=u),style:{width:"600px"},title:"开始录制",bordered:!1,size:"huge",preset:"dialog"},{action:Vue.withCtx(()=>[Vue.createVNode(k,null,{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(naive.NButton),{onClick:e[6]||(e[6]=()=>n.value=!1)},{default:Vue.withCtx(()=>[L]),_:1}),Vue.createVNode(Vue.unref(naive.NButton),{type:"info",onClick:N},{default:Vue.withCtx(()=>[M]),_:1})]),_:1})]),default:Vue.withCtx(()=>[Vue.createVNode(y,{model:o,rules:p,ref_key:"formRef",ref:V,"label-placement":"left","label-width":85,class:"py-4"},{default:Vue.withCtx(()=>[Vue.createVNode(d,{label:"录制格式",path:"recordType"},{default:Vue.withCtx(()=>[Vue.createVNode(g,{value:o.recordType,"onUpdate:value":e[2]||(e[2]=u=>o.recordType=u),name:"radiobuttongroup1"},{default:Vue.withCtx(()=>[(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(["flv","mp4","hls","raw"],u=>Vue.createVNode(x,{key:u,value:u,label:u},null,8,["value","label"])),64))]),_:1},8,["value"])]),_:1}),Vue.createVNode(d,{label:"流路径",path:"recordStreamPath"},{default:Vue.withCtx(()=>[Vue.createVNode(c,{placeholder:"输入需要录制的StreamPath",value:o.recordStreamPath,"onUpdate:value":e[3]||(e[3]=u=>o.recordStreamPath=u)},null,8,["value"])]),_:1}),Vue.createVNode(d,{label:"文件名",path:"fileName"},{default:Vue.withCtx(()=>[Vue.createVNode(c,{placeholder:"输入文件名",value:o.fileName,"onUpdate:value":e[4]||(e[4]=u=>o.fileName=u)},null,8,["value"])]),_:1}),Vue.createVNode(d,{label:"切片时间",path:"fragment"},{default:Vue.withCtx(()=>[Vue.createVNode(c,{placeholder:"输入切片时间",value:o.fragment,"onUpdate:value":e[5]||(e[5]=u=>o.fragment=u)},null,8,["value"])]),_:1})]),_:1},8,["model"]),$,A]),_:1},8,["show"])]),_:1})}}});export{Q as default};
