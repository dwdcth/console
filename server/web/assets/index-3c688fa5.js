import{T as g,B as y}from"./TableAction-a07ea7ef.js";import{_ as x}from"./index-5b101bf5.js";import{h as N}from"./vendor-1e70d1e5.js";import{h as B,p as P,s as S}from"./index-7a5dc880.js";import{_ as b}from"./index-0ce86e07.js";import"./useDesignSetting-42a1e924.js";const E=[{title:"开始时间",key:"StartTime",width:160,render(m){return Vue.h(naive.NTime,{time:new Date(m.StartTime),type:"relative"})}},{title:"类型",key:"Type",width:100},{title:"拉流地址",key:"RemoteURL"},{title:"StreamPath",key:"StreamPath"}];const k={class:"top"},A=Vue.createTextVNode("添加拉流"),T=Vue.createTextVNode("取消"),W=Vue.createTextVNode("确定"),R=Vue.defineComponent({__name:"index",setup(m){const{params:l}=N(),o=naive.useMessage(),r=Vue.reactive({target:"",streamPath:"",save:!1}),s=Vue.ref(!1),d=Vue.ref([]),n=Vue.ref(!1),f={target:{required:!0,message:"请输入远端流地址",trigger:"blur",validator(t,e){return e?e.startsWith("rtsp")||e.startsWith("rtmp")||/\.m3u8($|\?)/.test(e)||e.startsWith("http")?!0:(t.message="only support rtsp,rtmp,hls,hdl",!1):(t.message="请输入远端流地址",!1)}},streamPath:{required:!0,message:"请输入StreamPath",trigger:"blur",validator(t,e){return e?e.split("/").length==1?(t.message="StreamPath必须包含/",!1):e.startsWith("/")?(t.message="StreamPath开头不能包含/",!1):e.endsWith("/")?(t.message="StreamPath结尾不能包含/",!1):!0:(t.message="请输入StreamPath",!1)}}};async function V(){d.value=await B(l.id)}async function h(){s.value=!0;const{target:t,streamPath:e}=Vue.toRaw(r);let a="hdl";if(t.startsWith("rtsp"))a="rtsp";else if(t.startsWith("rtmp"))a="rtmp";else if(/\.m3u8($|\?)/.test(t))a="hls";else if(t.startsWith("http"))a="hdl";else{o.error("type not support"),s.value=!1;return}try{await P(l.id,a,e,encodeURI(t)),s.value=!1,n.value=!1,o.success("成功导入远端流")}catch(i){s.value=!1,o.error(i)}}async function _(t){try{await S(l.id,t.StreamPath),o.success("删除成功")}catch(e){o.error(e.toString())}}const C=Vue.reactive({title:"操作",key:"action",fixed:"right",width:100,render(t){return Vue.h(g,{style:"button",actions:[{label:"删除",type:"error",icon:"ic:outline-delete-outline",onClick:_.bind(null,t),ifShow:()=>!0}]})}});return(t,e)=>{const a=Vue.resolveComponent("n-button"),i=Vue.resolveComponent("n-card"),p=Vue.resolveComponent("n-input"),c=Vue.resolveComponent("n-form-item"),v=Vue.resolveComponent("n-switch"),F=Vue.resolveComponent("n-form"),w=Vue.resolveComponent("n-space"),D=Vue.resolveComponent("n-modal");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createElementVNode("div",k,[Vue.createVNode(Vue.unref(x),{onTick:V})]),Vue.createVNode(i,{bordered:!1,class:"proCard"},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(y),{title:"远端拉流列表",class:"table","row-class-name":"row",columns:Vue.unref(E),dataSource:d.value,pagination:!1,actionColumn:C,"row-key":u=>u.id,"scroll-x":1090},{toolbar:Vue.withCtx(()=>[Vue.createVNode(a,{onClick:e[0]||(e[0]=u=>n.value=!0),type:"primary",round:""},{default:Vue.withCtx(()=>[A]),_:1})]),_:1},8,["columns","dataSource","actionColumn","row-key"])]),_:1}),Vue.createVNode(D,{show:n.value,"onUpdate:show":e[5]||(e[5]=u=>n.value=u),"show-icon":!1,preset:"dialog",title:"从远端服务器导入流"},{action:Vue.withCtx(()=>[Vue.createVNode(w,null,{default:Vue.withCtx(()=>[Vue.createVNode(a,{onClick:e[4]||(e[4]=()=>n.value=!1)},{default:Vue.withCtx(()=>[T]),_:1}),Vue.createVNode(a,{type:"info",loading:s.value,onClick:h},{default:Vue.withCtx(()=>[W]),_:1},8,["loading"])]),_:1})]),default:Vue.withCtx(()=>[Vue.createVNode(F,{model:r,rules:f,ref:"formRef","label-placement":"left","label-width":80,class:"py-4"},{default:Vue.withCtx(()=>[Vue.createVNode(c,{label:"远端流地址",path:"target"},{default:Vue.withCtx(()=>[Vue.createVNode(p,{placeholder:"请输入远端流的地址",value:r.target,"onUpdate:value":e[1]||(e[1]=u=>r.target=u)},null,8,["value"])]),_:1}),Vue.createVNode(c,{label:"StreamPath",path:"streamPath"},{default:Vue.withCtx(()=>[Vue.createVNode(p,{placeholder:"请输入StreamPath",value:r.streamPath,"onUpdate:value":e[2]||(e[2]=u=>r.streamPath=u)},null,8,["value"])]),_:1}),Vue.createVNode(c,{label:"重启后恢复",path:"save"},{default:Vue.withCtx(()=>[Vue.createVNode(v,{value:r.save,"onUpdate:value":e[3]||(e[3]=u=>r.save=u)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])])}}}),j=b(R,[["__scopeId","data-v-11cc7a89"]]);export{j as default};
