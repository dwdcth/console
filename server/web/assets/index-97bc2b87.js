import{T as e,B as t}from"./TableAction-c17a6634.js";import{_ as a}from"./index-b3347c9f.js";import{i as r}from"./vendor-2e943313.js";import{f as o,p as l,s as u}from"./index-8caa8cc3.js";import{_ as s}from"./index-dbd922fe.js";import"./useDesignSetting-a0c3f2ea.js";const i=[{title:"开始时间",key:"StartTime",width:160,render:e=>Vue.h(naive.NTime,{time:new Date(e.StartTime),type:"relative"})},{title:"类型",key:"Type",width:100},{title:"拉流地址",key:"RemoteURL"},{title:"StreamPath",key:"StreamPath"}],n={class:"top"},d=Vue.createTextVNode("添加拉流"),c=Vue.createTextVNode("取消"),m=Vue.createTextVNode("确定"),V=s(Vue.defineComponent({__name:"index",setup(s){const{params:V}=r(),h=naive.useMessage(),p=Vue.reactive({target:"",streamPath:"",save:!1}),v=Vue.ref(!1),f=Vue.ref([]),w=Vue.ref(!1),g={target:{required:!0,message:"请输入远端流地址",trigger:"blur",validator:(e,t)=>t?!!t.startsWith("rtsp")||(!!t.startsWith("rtmp")||(!!/\.m3u8($|\?)/.test(t)||(!!t.startsWith("http")||(e.message="only support rtsp,rtmp,hls,hdl",!1)))):(e.message="请输入远端流地址",!1)},streamPath:{required:!0,message:"请输入StreamPath",trigger:"blur",validator:(e,t)=>t?1==t.split("/").length?(e.message="StreamPath必须包含/",!1):t.startsWith("/")?(e.message="StreamPath开头不能包含/",!1):!t.endsWith("/")||(e.message="StreamPath结尾不能包含/",!1):(e.message="请输入StreamPath",!1)}};async function C(){f.value=await o(V.id)}async function x(){v.value=!0;const{target:e,streamPath:t}=Vue.toRaw(p);let a="hdl";if(e.startsWith("rtsp"))a="rtsp";else if(e.startsWith("rtmp"))a="rtmp";else if(/\.m3u8($|\?)/.test(e))a="hls";else{if(!e.startsWith("http"))return h.error("type not support"),void(v.value=!1);a="hdl"}try{await l(V.id,a,t,e),v.value=!1,w.value=!1,h.success("成功导入远端流")}catch(r){v.value=!1,h.error(r)}}async function y(e){try{await u(V.id,e.StreamPath),h.success("删除成功")}catch(t){h.error(t.toString())}}const N=Vue.reactive({title:"操作",key:"action",fixed:"right",width:100,render:t=>Vue.h(e,{style:"button",actions:[{label:"删除",type:"error",icon:"ic:outline-delete-outline",onClick:y.bind(null,t),ifShow:()=>!0}]})});return(e,r)=>{const o=Vue.resolveComponent("n-button"),l=Vue.resolveComponent("n-card"),u=Vue.resolveComponent("n-input"),s=Vue.resolveComponent("n-form-item"),V=Vue.resolveComponent("n-switch"),h=Vue.resolveComponent("n-form"),y=Vue.resolveComponent("n-space"),S=Vue.resolveComponent("n-modal");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createElementVNode("div",n,[Vue.createVNode(Vue.unref(a),{onTick:C})]),Vue.createVNode(l,{bordered:!1,class:"proCard"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(t),{title:"远端拉流列表",class:"table","row-class-name":"row",columns:Vue.unref(i),dataSource:f.value,pagination:!1,actionColumn:N,"row-key":e=>e.id,"scroll-x":1090},{toolbar:Vue.withCtx((()=>[Vue.createVNode(o,{onClick:r[0]||(r[0]=e=>w.value=!0),type:"primary",round:""},{default:Vue.withCtx((()=>[d])),_:1})])),_:1},8,["columns","dataSource","actionColumn","row-key"])])),_:1}),Vue.createVNode(S,{show:w.value,"onUpdate:show":r[5]||(r[5]=e=>w.value=e),"show-icon":!1,preset:"dialog",title:"从远端服务器导入流"},{action:Vue.withCtx((()=>[Vue.createVNode(y,null,{default:Vue.withCtx((()=>[Vue.createVNode(o,{onClick:r[4]||(r[4]=()=>w.value=!1)},{default:Vue.withCtx((()=>[c])),_:1}),Vue.createVNode(o,{type:"info",loading:v.value,onClick:x},{default:Vue.withCtx((()=>[m])),_:1},8,["loading"])])),_:1})])),default:Vue.withCtx((()=>[Vue.createVNode(h,{model:p,rules:g,ref:"formRef","label-placement":"left","label-width":80,class:"py-4"},{default:Vue.withCtx((()=>[Vue.createVNode(s,{label:"远端流地址",path:"target"},{default:Vue.withCtx((()=>[Vue.createVNode(u,{placeholder:"请输入远端流的地址",value:p.target,"onUpdate:value":r[1]||(r[1]=e=>p.target=e)},null,8,["value"])])),_:1}),Vue.createVNode(s,{label:"StreamPath",path:"streamPath"},{default:Vue.withCtx((()=>[Vue.createVNode(u,{placeholder:"请输入StreamPath",value:p.streamPath,"onUpdate:value":r[2]||(r[2]=e=>p.streamPath=e)},null,8,["value"])])),_:1}),Vue.createVNode(s,{label:"重启后恢复",path:"save"},{default:Vue.withCtx((()=>[Vue.createVNode(V,{value:p.save,"onUpdate:value":r[3]||(r[3]=e=>p.save=e)},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["show"])])}}}),[["__scopeId","data-v-eaa4fff8"]]);export{V as default};
