import{g as e,t}from"./vendor-2e943313.js";import{T as n,B as a}from"./TableAction-c17a6634.js";import{_ as l}from"./index-b3347c9f.js";import{A as o,B as u,e as r,u as i}from"./index-8caa8cc3.js";import{c}from"./index-dbd922fe.js";import"./useDesignSetting-a0c3f2ea.js";function s(){const{loading:e,error:t,result:n,fetchResource:a}=function(e){const t=Vue.ref(!1),n=Vue.ref(null),a=Vue.ref(null);return{loading:t,error:a,result:n,fetchResource:l=>(t.value=!0,e(l).then((e=>{n.value=e})).catch((e=>{a.value=e})).finally((()=>{t.value=!1})))}}(o);return{loading:e,error:t,list:n,fetchResource:a}}const d=[{title:"id",key:"id",width:50},{title:"名称",key:"name",width:100},{title:"secret",key:"secret",width:200},{title:"创建时间",key:"createtime",width:200},{title:"状态",key:"online",width:100,render:e=>Vue.h(naive.NTag,{style:{marginRight:"6px"},type:1==e.online?"success":"error",bordered:!1},{default:()=>1==e.online?"在线":"离线"})}],V=Vue.createTextVNode(" 新建 "),f=Vue.createTextVNode("取消"),m=Vue.createTextVNode("确定"),v=Vue.defineComponent({__name:"index",setup(o){const v={name:{required:!0,trigger:["blur","input"],message:"请输入名称"}},p=naive.useDialog(),h=Vue.ref(null),C=naive.useMessage(),w=Vue.ref(),b=e(),x=c(),k=Vue.ref(!1),y=Vue.ref(!1),g=Vue.reactive({name:"",url:"",enableReport:!1,resetSecret:!1}),N=Vue.ref(""),_=Vue.ref({id:"",name:"",mail:"",secret:""}),R=Vue.ref([]),S=Vue.reactive({width:200,title:"操作",key:"action",render:e=>Vue.h(n,{style:"button",actions:[{label:"详情",type:"primary",disabled:1!=e.online,onClick:A.bind(null,e)},{label:"编辑",type:"primary",onClick:D.bind(null,e),ifShow:()=>!0},{label:"删除",type:"error",icon:"ic:outline-delete-outline",onClick:$.bind(null,e),ifShow:()=>!0}],select:e=>{C.info(`您点击了，${e} 按钮`)}})});function T(){g.name="",g.url="",N.value="新建实例",k.value=!0}async function j(){const{list:e,error:t,fetchResource:n}=s();await n({pagesize:0,pageno:0}),t.value?C.info(`error--${t.value}`):R.value=e.value.data.list}function U(e){}function B(e){e.preventDefault(),y.value=!0,h.value.validate((e=>{if(e)C.error("请填写完整信息");else if("新建实例"==N.value){const e=g.name;r({name:e}).then((()=>{C.success("新建成功")}))}else if("编辑实例"==N.value){const e=_.value.id;i({id:e,...g}).then((()=>{C.success("编辑成功"),k.value=!1}))}y.value=!1}))}function D(e){g.name=e.name,g.url=e.url,g.enableReport=1==e.report,N.value="编辑实例",k.value=!0,_.value.id=e.id,_.value.name=e.name,_.value.mail=localStorage.getItem("mail")||""}function A(e){const t=e.id,n=b.resolve({name:"instance_dashboard",params:{id:t}});window.open(n.href,"_blank")}function $(e){p.info({title:"提示",content:"您确定要删除此实例吗",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{u({id:e.id}).then((()=>{C.success("删除成功")}))},onNegativeClick:()=>{}})}return(e,n)=>{const o=Vue.resolveComponent("n-icon"),u=Vue.resolveComponent("n-button"),r=Vue.resolveComponent("n-input"),i=Vue.resolveComponent("n-form-item"),c=Vue.resolveComponent("n-checkbox"),s=Vue.resolveComponent("n-switch"),p=Vue.resolveComponent("n-form"),C=Vue.resolveComponent("n-space"),b=Vue.resolveComponent("n-modal"),_=Vue.resolveComponent("n-card");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createVNode(Vue.unref(l),{onTick:j}),Vue.createVNode(_,{bordered:!1,class:"proCard"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(a),{columns:Vue.unref(d),dataSource:R.value,"row-key":e=>e.id,pagination:!1,ref_key:"actionRef",ref:w,actionColumn:S,"onUpdate:checkedRowKeys":U,"scroll-x":1090},{tableTitle:Vue.withCtx((()=>[Vue.createVNode(u,{type:"primary",onClick:T},{icon:Vue.withCtx((()=>[Vue.createVNode(o,null,{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(t))])),_:1})])),default:Vue.withCtx((()=>[V])),_:1})])),_:1},8,["columns","dataSource","row-key","actionColumn"]),Vue.createVNode(b,{show:k.value,"onUpdate:show":n[4]||(n[4]=e=>k.value=e),"show-icon":!1,preset:"dialog",title:N.value},{action:Vue.withCtx((()=>[Vue.createVNode(C,null,{default:Vue.withCtx((()=>[Vue.createVNode(u,{onClick:n[3]||(n[3]=()=>k.value=!1)},{default:Vue.withCtx((()=>[f])),_:1}),Vue.createVNode(u,{type:"info",loading:y.value,onClick:B},{default:Vue.withCtx((()=>[m])),_:1},8,["loading"])])),_:1})])),default:Vue.withCtx((()=>[Vue.createVNode(p,{model:g,rules:v,ref_key:"formRef",ref:h,"label-placement":"left","label-width":85,class:"py-4"},{default:Vue.withCtx((()=>[Vue.createVNode(i,{label:"名称",path:"name"},{default:Vue.withCtx((()=>[Vue.createVNode(r,{placeholder:"请输入实例名称",value:g.name,"onUpdate:value":n[0]||(n[0]=e=>g.name=e)},null,8,["value"])])),_:1}),Vue.createVNode(i,{label:"重置 secret",path:"resetSecret"},{default:Vue.withCtx((()=>[Vue.createVNode(c,{checked:g.resetSecret,"onUpdate:checked":n[1]||(n[1]=e=>g.resetSecret=e)},null,8,["checked"])])),_:1}),Vue.createVNode(i,{label:"监控",path:"enableReport"},{default:Vue.withCtx((()=>[Vue.createVNode(s,{value:g.enableReport,"onUpdate:value":n[2]||(n[2]=e=>g.enableReport=e),disabled:0==Vue.unref(x).level},null,8,["value","disabled"])])),_:1})])),_:1},8,["model"])])),_:1},8,["show","title"])])),_:1})])}}});export{v as default};
